{"version":3,"file":"index.js","sources":["../../src/index.ts"],"sourcesContent":["import viteReact from '@vitejs/plugin-react'\nimport { TanStackStartVitePluginCore } from '@tanstack/start-plugin-core'\nimport { getTanStackStartOptions } from './schema'\nimport type { TanStackStartInputConfig, WithReactPlugin } from './schema'\nimport type { PluginOption } from 'vite'\n\nexport type {\n  TanStackStartInputConfig,\n  TanStackStartOutputConfig,\n  WithReactPlugin,\n} from './schema'\n\nexport function TanStackStartVitePlugin(\n  opts?: TanStackStartInputConfig & WithReactPlugin,\n): Array<PluginOption> {\n  type OptionsWithReact = ReturnType<typeof getTanStackStartOptions> &\n    WithReactPlugin\n  const options: OptionsWithReact = getTanStackStartOptions(opts)\n\n  if (opts?.customViteReactPlugin !== true) {\n    console.warn(\n      `please add the vite-react plugin to your Vite config and set 'customViteReactPlugin: true'`,\n    )\n    console.warn(\n      `TanStack Start will not configure the vite-react plugin in future anymore.`,\n    )\n  }\n\n  return [\n    TanStackStartVitePluginCore(\n      {\n        framework: 'react',\n        getVirtualServerRootHandler(ctx) {\n          return `\nimport { toWebRequest, defineEventHandler } from '@tanstack/react-start/server';\nimport serverEntry from '${ctx.serverEntryFilepath}';\n\nexport default defineEventHandler(function(event) {\n  const request = toWebRequest(event);\n  return serverEntry({ request });\n});`\n        },\n        getVirtualClientEntry(ctx) {\n          return `\nimport { StrictMode, startTransition } from 'react';\nimport { hydrateRoot } from 'react-dom/client';\nimport { StartClient } from '@tanstack/react-start';\nimport { createRouter } from '${ctx.routerFilepath}';\n\nconst router = createRouter();\n\nstartTransition(() => {\n  hydrateRoot(\n    document,\n    <StrictMode>\n      <StartClient router={router} />\n    </StrictMode>\n  );\n});`\n        },\n        getVirtualServerEntry(ctx) {\n          return `\nimport { createStartHandler, defaultStreamHandler } from '@tanstack/react-start/server';\nimport { createRouter } from '${ctx.routerFilepath}';\n\nexport default createStartHandler({\n  createRouter,\n})(defaultStreamHandler);`\n        },\n      },\n      options,\n    ),\n    !opts?.customViteReactPlugin && viteReact(options.react),\n  ]\n}\n\nexport { TanStackStartVitePlugin as tanstackStart }\n"],"names":[],"mappings":";;;AAYO,SAAS,wBACd,MACqB;AAGf,QAAA,UAA4B,wBAAwB,IAAI;AAE1D,OAAA,6BAAM,2BAA0B,MAAM;AAChC,YAAA;AAAA,MACN;AAAA,IACF;AACQ,YAAA;AAAA,MACN;AAAA,IACF;AAAA,EAAA;AAGK,SAAA;AAAA,IACL;AAAA,MACE;AAAA,QACE,WAAW;AAAA,QACX,4BAA4B,KAAK;AACxB,iBAAA;AAAA;AAAA,2BAEU,IAAI,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAM1C;AAAA,QACA,sBAAsB,KAAK;AAClB,iBAAA;AAAA;AAAA;AAAA;AAAA,gCAIe,IAAI,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAY1C;AAAA,QACA,sBAAsB,KAAK;AAClB,iBAAA;AAAA;AAAA,gCAEe,IAAI,cAAc;AAAA;AAAA;AAAA;AAAA;AAAA,QAAA;AAAA,MAM5C;AAAA,MACA;AAAA,IACF;AAAA,IACA,EAAC,6BAAM,0BAAyB,UAAU,QAAQ,KAAK;AAAA,EACzD;AACF;"}